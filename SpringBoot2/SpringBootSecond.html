<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>二，核心技术一 | 有空看看</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/dose1/assets/css/0.styles.c9546c7c.css" as="style"><link rel="preload" href="/dose1/assets/js/app.370f2ecb.js" as="script"><link rel="preload" href="/dose1/assets/js/2.579f079f.js" as="script"><link rel="preload" href="/dose1/assets/js/9.fb95937f.js" as="script"><link rel="prefetch" href="/dose1/assets/js/10.15b385d2.js"><link rel="prefetch" href="/dose1/assets/js/11.7719a193.js"><link rel="prefetch" href="/dose1/assets/js/12.7a3b1235.js"><link rel="prefetch" href="/dose1/assets/js/13.bf569039.js"><link rel="prefetch" href="/dose1/assets/js/14.f04af72a.js"><link rel="prefetch" href="/dose1/assets/js/15.cae4f64f.js"><link rel="prefetch" href="/dose1/assets/js/16.28681f08.js"><link rel="prefetch" href="/dose1/assets/js/17.54584c3d.js"><link rel="prefetch" href="/dose1/assets/js/18.4b466fb7.js"><link rel="prefetch" href="/dose1/assets/js/19.882f21ee.js"><link rel="prefetch" href="/dose1/assets/js/20.6d8d7aa6.js"><link rel="prefetch" href="/dose1/assets/js/21.ed3f43c1.js"><link rel="prefetch" href="/dose1/assets/js/22.b9fd778f.js"><link rel="prefetch" href="/dose1/assets/js/23.2563d097.js"><link rel="prefetch" href="/dose1/assets/js/24.33dab2d6.js"><link rel="prefetch" href="/dose1/assets/js/25.35b2c93b.js"><link rel="prefetch" href="/dose1/assets/js/26.fa63a29b.js"><link rel="prefetch" href="/dose1/assets/js/27.a5ca9c28.js"><link rel="prefetch" href="/dose1/assets/js/28.c8d6aeb7.js"><link rel="prefetch" href="/dose1/assets/js/29.bc350787.js"><link rel="prefetch" href="/dose1/assets/js/3.dddbab9e.js"><link rel="prefetch" href="/dose1/assets/js/4.dacb7f3f.js"><link rel="prefetch" href="/dose1/assets/js/5.516cbc1e.js"><link rel="prefetch" href="/dose1/assets/js/6.c1a5c5b5.js"><link rel="prefetch" href="/dose1/assets/js/7.eb3c1009.js"><link rel="prefetch" href="/dose1/assets/js/8.7ced4e1e.js">
    <link rel="stylesheet" href="/dose1/assets/css/0.styles.c9546c7c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dose1/" class="home-link router-link-active"><img src="/dose1/assets/img/logo.jpg" alt="有空看看" class="logo"> <span class="site-name can-hide">有空看看</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dose1/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/datarepo/mysql/mysql.html" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/dose1/foo/two.html" class="nav-link">
  备用
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/mybefore/mybase/前端基础.html" class="nav-link">
  三件套
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myjQuery/jQuery.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myajax/ajax.html" class="nav-link">
  AJAX
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myVue/Vue2/Vue1.html" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myVue/Vue3/Vue3.html" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/springpre/pre.html" class="nav-link">
  spring前言
</a></li><li class="dropdown-item"><!----> <a href="/dose1/springmvc/springmvc.html" class="nav-link">
  springMVC
</a></li><li class="dropdown-item"><!----> <a href="/dose1/SpringBoot2/SpringBootFirst.html" class="nav-link">
  springBoot2
</a></li><li class="dropdown-item"><!----> <a href="/dose1/foo/one.html" class="nav-link">
  备用
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/other/newJava.html" class="nav-link">
  java8新特性
</a></li><li class="dropdown-item"><!----> <a href="/dose1/other/HashMap.html" class="nav-link">
  hashmap
</a></li><li class="dropdown-item"><!----> <a href="https://jojo-995.gitee.io/2021/03/06/markdown-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  markdown
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/dose1/foo/two.html" class="nav-link">
  备用
</a></li></ul></div></div> <a href="https://github.com/jack110959/dose1" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dose1/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/datarepo/mysql/mysql.html" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/dose1/foo/two.html" class="nav-link">
  备用
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/mybefore/mybase/前端基础.html" class="nav-link">
  三件套
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myjQuery/jQuery.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myajax/ajax.html" class="nav-link">
  AJAX
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myVue/Vue2/Vue1.html" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/dose1/mybefore/myVue/Vue3/Vue3.html" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/springpre/pre.html" class="nav-link">
  spring前言
</a></li><li class="dropdown-item"><!----> <a href="/dose1/springmvc/springmvc.html" class="nav-link">
  springMVC
</a></li><li class="dropdown-item"><!----> <a href="/dose1/SpringBoot2/SpringBootFirst.html" class="nav-link">
  springBoot2
</a></li><li class="dropdown-item"><!----> <a href="/dose1/foo/one.html" class="nav-link">
  备用
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dose1/other/newJava.html" class="nav-link">
  java8新特性
</a></li><li class="dropdown-item"><!----> <a href="/dose1/other/HashMap.html" class="nav-link">
  hashmap
</a></li><li class="dropdown-item"><!----> <a href="https://jojo-995.gitee.io/2021/03/06/markdown-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  markdown
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/dose1/foo/two.html" class="nav-link">
  备用
</a></li></ul></div></div> <a href="https://github.com/jack110959/dose1" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring Boot2</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dose1/SpringBoot2/SpringBootFirst.html" class="sidebar-link">一，基础入门</a></li><li><a href="/dose1/SpringBoot2/SpringBootSecond.html" aria-current="page" class="active sidebar-link">二，核心技术一</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_1-配置文件" class="sidebar-link">1，配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_1-1、文件类型" class="sidebar-link">1.1、文件类型</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_1-2-配置提示" class="sidebar-link">1.2，配置提示</a></li></ul></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_2-web开发" class="sidebar-link">2，Web开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_1、springmvc自动配置概览" class="sidebar-link">1、SpringMVC自动配置概览</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_2、简单功能分析" class="sidebar-link">2、简单功能分析</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_3、请求参数处理" class="sidebar-link">3、请求参数处理</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_4、数据响应与内容协商" class="sidebar-link">4、数据响应与内容协商</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_5、视图解析与模板引擎" class="sidebar-link">5、视图解析与模板引擎</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_6、拦截器" class="sidebar-link">6、拦截器</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_7、文件上传" class="sidebar-link">7、文件上传</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_8、异常处理" class="sidebar-link">8、异常处理</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_9、web原生组件注入-servlet、filter、listener" class="sidebar-link">9、Web原生组件注入（Servlet、Filter、Listener）</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_10、嵌入式servlet容器" class="sidebar-link">10、嵌入式Servlet容器</a></li><li class="sidebar-sub-header"><a href="/dose1/SpringBoot2/SpringBootSecond.html#_11、定制化原理" class="sidebar-link">11、定制化原理</a></li></ul></li></ul></li><li><a href="/dose1/SpringBoot2/SpringBootThird.html" class="sidebar-link">三，核心技术二</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="二-核心技术一"><a href="#二-核心技术一" class="header-anchor">#</a> <strong>二，核心技术一</strong></h1> <img src="https://github.com/jack110959/pictures/blob/main/imgspringboot%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF.jpg?raw=true" alt="image-20211012160624763" style="zoom:50%;"> <h2 id="_1-配置文件"><a href="#_1-配置文件" class="header-anchor">#</a> 1，配置文件</h2> <h3 id="_1-1、文件类型"><a href="#_1-1、文件类型" class="header-anchor">#</a> 1.1、文件类型</h3> <h4 id="_1-properties"><a href="#_1-properties" class="header-anchor">#</a> (1)，properties</h4> <p>同以前的properties用法</p> <h4 id="_2-yaml"><a href="#_2-yaml" class="header-anchor">#</a> (2)，yaml</h4> <p><strong>简介</strong></p> <p>YAML 是 &quot;YAML Ain't Markup Language&quot;（YAML 不是一种标记语言）的递归缩写。在开发的这种语言时，YAML 的意思其实是：&quot;Yet Another Markup Language&quot;（仍是一种标记语言）。</p> <p>非常适合用来做以数据为中心的配置文件</p> <p><strong>基本语法</strong></p> <p>●key: value；kv之间有空格</p> <p>●大小写敏感</p> <p>●使用缩进表示层级关系</p> <p>●缩进不允许使用tab，只允许空格</p> <p>●缩进的空格数不重要，只要相同层级的元素左对齐即可</p> <p>●'#'表示注释</p> <p>●字符串无需加引号，如果要加，单引号原样输出，双引号中的字符如/n会换行</p> <p><strong>数据类型</strong></p> <p>●字面量：单个的、不可再分的值。date、boolean、string、number、null</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">k</span><span class="token punctuation">:</span> v
</code></pre></div><p>●对象：键值对的集合。map、hash、set、object</p> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">行内写法：  k</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>k1<span class="token punctuation">:</span>v1<span class="token punctuation">,</span>k2<span class="token punctuation">:</span>v2<span class="token punctuation">,</span>k3<span class="token punctuation">:</span>v3<span class="token punctuation">}</span>
<span class="token comment">#或</span>
<span class="token key atrule">k</span><span class="token punctuation">:</span> 
  <span class="token key atrule">k1</span><span class="token punctuation">:</span> v1
  <span class="token key atrule">k2</span><span class="token punctuation">:</span> v2
  <span class="token key atrule">k3</span><span class="token punctuation">:</span> v3
</code></pre></div><p>●数组：一组按次序排列的值。array、list、queue</p> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">行内写法：  k</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">,</span>v3<span class="token punctuation">]</span>
<span class="token comment">#或者</span>
<span class="token key atrule">k</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> v1
 <span class="token punctuation">-</span> v2
 <span class="token punctuation">-</span> v3
</code></pre></div><p>1.2.4、示例</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Boolean</span> boss<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Pet</span> pet<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interests<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> animal<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> score<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> salarys<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> allPets<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pet</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Double</span> weight<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>yaml表示以上对象</p> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">person</span><span class="token punctuation">:</span>
  <span class="token key atrule">userName</span><span class="token punctuation">:</span> zhangsan
  <span class="token key atrule">boss</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 2019/12/12 20<span class="token punctuation">:</span><span class="token datetime number">12:33</span>
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">18</span>
  <span class="token key atrule">pet</span><span class="token punctuation">:</span> 
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
    <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">23.4</span>
  <span class="token key atrule">interests</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>篮球<span class="token punctuation">,</span>游泳<span class="token punctuation">]</span>
  <span class="token key atrule">animal</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> jerry
    <span class="token punctuation">-</span> mario
  <span class="token key atrule">score</span><span class="token punctuation">:</span>
    <span class="token key atrule">english</span><span class="token punctuation">:</span> 
      <span class="token key atrule">first</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">second</span><span class="token punctuation">:</span> <span class="token number">40</span>
      <span class="token key atrule">third</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">math</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">131</span><span class="token punctuation">,</span><span class="token number">140</span><span class="token punctuation">,</span><span class="token number">148</span><span class="token punctuation">]</span>
    <span class="token key atrule">chinese</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">first</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">,</span><span class="token key atrule">second</span><span class="token punctuation">:</span> <span class="token number">136</span><span class="token punctuation">}</span>
  <span class="token key atrule">salarys</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3999</span><span class="token punctuation">,</span><span class="token number">4999.98</span><span class="token punctuation">,</span><span class="token number">5999.99</span><span class="token punctuation">]</span>
  <span class="token key atrule">allPets</span><span class="token punctuation">:</span>
    <span class="token key atrule">sick</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> tom<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> jerry<span class="token punctuation">,</span><span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">47</span><span class="token punctuation">}</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> mario<span class="token punctuation">,</span><span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">47</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="_1-2-配置提示"><a href="#_1-2-配置提示" class="header-anchor">#</a> 1.2，配置提示</h3> <p>自定义的类和<strong>配置文件绑定</strong>一般没有提示。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 配置提示依赖 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
             <span class="token comment">&lt;!-- 添加下面的configuration，可以在打包成jar时排除掉上面的提示依赖 --&gt;</span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>
                         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_2-web开发"><a href="#_2-web开发" class="header-anchor">#</a> 2，Web开发</h2> <p><strong>目录总览</strong></p> <img src="https://github.com/jack110959/pictures/blob/main/imgyuque_diagram.jpg?raw=true" alt="web目录" style="zoom:50%;"> <h3 id="_1、springmvc自动配置概览"><a href="#_1、springmvc自动配置概览" class="header-anchor">#</a> 1、SpringMVC自动配置概览</h3> <p><a href="https://docs.spring.io/spring-boot/docs/2.5.5/reference/html/features.html#features.developing-web-applications.spring-mvc.auto-configuration" target="_blank" rel="noopener noreferrer">官网介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Spring Boot provides auto-configuration for Spring MVC that <strong>works well with most applications.(大多场景我们都无需自定义配置)</strong></p> <p>The auto-configuration adds the following features on top of Spring’s defaults:</p> <ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p></li> <li></li> <li><p>Support for serving static resources, including support for WebJars (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content" target="_blank" rel="noopener noreferrer">later in this document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)).</p></li> <li></li> <li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</p></li> <li></li> <li><p>Support for <code>HttpMessageConverters</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters" target="_blank" rel="noopener noreferrer">later in this document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p></li> <li></li> <li><p>Automatic registration of <code>MessageCodesResolver</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-message-codes" target="_blank" rel="noopener noreferrer">later in this document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p></li> <li></li> <li><p>Static <code>index.html</code> support.</p></li> <li></li> <li><p>Custom <code>Favicon</code> support (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon" target="_blank" rel="noopener noreferrer">later in this document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p></li> <li></li> <li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer" target="_blank" rel="noopener noreferrer">later in this document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p></li> <li></li></ul> <h3 id="_2、简单功能分析"><a href="#_2、简单功能分析" class="header-anchor">#</a> 2、简单功能分析</h3> <h4 id="_2-1、静态资源访问"><a href="#_2-1、静态资源访问" class="header-anchor">#</a> 2.1、静态资源访问</h4> <p><a href="https://docs.spring.io/spring-boot/docs/2.5.5/reference/html/features.html#features.developing-web-applications.spring-mvc.static-content" target="_blank" rel="noopener noreferrer">官网介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>1、静态资源目录</strong></p> <p>只要静态资源放在类路径(resources)下： called <code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code></p> <p>访问 ： 当前项目根路径/ + 静态资源名</p> <p>原理： 静态映射/**。</p> <p><strong>请求进来，先去找Controller看能不能处理。不能处理的所有请求又都交给静态资源处理器。静态资源也找不到则响应404页面</strong></p> <p>改变默认的静态资源路径</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#静态资源将会只在数组中的文件路径下查找</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">static-locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>classpath<span class="token punctuation">:</span>/haha/<span class="token punctuation">]</span>
</code></pre></div><p><strong>2、静态资源访问前缀</strong></p> <p>默认无前缀</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#访问路径为当前项目根路径/res/ + 静态资源名(可用来配合拦截器)</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> /resources/<span class="token important">**</span>
</code></pre></div><p>当前项目 + static-path-pattern + 静态资源名 = 静态资源文件夹下找</p> <p><strong>3、webjar</strong></p> <p>自动映射 /<a href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js" target="_blank" rel="noopener noreferrer">webjars<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/**</p> <p>https://www.webjars.org/</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 从webjars引入依赖 --&gt;</span>   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.webjars<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jquery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>访问地址：<a href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js" target="_blank" rel="noopener noreferrer">http://localhost:8080/webjars/<strong>jquery/3.5.1/jquery.js</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>   后面地址要按照依赖里面的包路径</p> <h4 id="_2-2、欢迎页支持"><a href="#_2-2、欢迎页支持" class="header-anchor">#</a> 2.2、欢迎页支持</h4> <ul><li><p>静态资源路径下  index.html</p> <p>可以配置静态资源路径</p> <p>但是不可以配置静态资源的访问前缀。否则导致 index.html不能被默认访问</p></li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">#这个会导致welcome page功能失效</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> /res/<span class="token important">**</span>   
</code></pre></div><h4 id="_2-3、自定义-favicon"><a href="#_2-3、自定义-favicon" class="header-anchor">#</a> 2.3、自定义 <code>Favicon</code></h4> <p>favicon.ico 放在静态资源目录下即可。</p> <p>同样不可以配置静态资源的访问前缀。</p> <h4 id="_2-4、静态资源配置原理"><a href="#_2-4、静态资源配置原理" class="header-anchor">#</a> 2.4、静态资源配置原理</h4> <ul><li><p>SpringBoot启动默认加载  xxxAutoConfiguration 类（自动配置类）</p></li> <li><p>SpringMVC功能的自动配置类 WebMvcAutoConfiguration，生效</p> <p><strong>路径</strong>：org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SERVLET<span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurationSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span>HIGHEST_PRECEDENCE <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">DispatcherServletAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">TaskExecutionAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
		<span class="token class-name">ValidationAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfiguration</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>给容器中配了什么。</li></ul> <p>WebMvcAutoConfiguration类中的静态内部类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">EnableWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
		<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span>ResourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">,</span> <span class="token class-name">ServletContextAware</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li><p>配置文件的相关属性和xxx进行了绑定。</p> <p>WebMvcProperties==<strong>spring.mvc</strong></p> <p>ResourceProperties==<strong>spring.resources</strong></p> <p>WebProperties==<strong>spring.web</strong></p></li></ul> <h5 id="几个扩展小知识"><a href="#几个扩展小知识" class="header-anchor">#</a> <strong>几个扩展小知识</strong></h5> <p><strong>1，配置类只有一个有参构造器</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//有参构造器所有参数的值都会从容器中确定</span>
<span class="token comment">//ResourceProperties resourceProperties；获取和spring.resources绑定的所有的值的对象</span>
<span class="token comment">//WebMvcProperties mvcProperties 获取和spring.mvc绑定的所有的值的对象</span>
<span class="token comment">//ListableBeanFactory beanFactory Spring的beanFactory</span>
<span class="token comment">//HttpMessageConverters 找到所有的HttpMessageConverters</span>
<span class="token comment">//ResourceHandlerRegistrationCustomizer 找到 资源处理器的自定义器。=========</span>
<span class="token comment">//DispatcherServletPath  </span>
<span class="token comment">//ServletRegistrationBean   给应用注册Servlet、Filter....</span>
	<span class="token keyword">public</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span><span class="token punctuation">(</span>
				<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span>ResourceProperties</span> resourceProperties<span class="token punctuation">,</span>
				<span class="token class-name">WebProperties</span> webProperties<span class="token punctuation">,</span> <span class="token class-name">WebMvcProperties</span> mvcProperties<span class="token punctuation">,</span> <span class="token class-name">ListableBeanFactory</span> beanFactory<span class="token punctuation">,</span>
				<span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverters</span><span class="token punctuation">&gt;</span></span> messageConvertersProvider<span class="token punctuation">,</span>
				<span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResourceHandlerRegistrationCustomizer</span><span class="token punctuation">&gt;</span></span> resourceHandlerRegistrationCustomizerProvider<span class="token punctuation">,</span>
				<span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DispatcherServletPath</span><span class="token punctuation">&gt;</span></span> dispatcherServletPath<span class="token punctuation">,</span>
				<span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> servletRegistrations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties <span class="token operator">=</span> resourceProperties<span class="token punctuation">.</span><span class="token function">hasBeenCustomized</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> resourceProperties
					<span class="token operator">:</span> webProperties<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties <span class="token operator">=</span> mvcProperties<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>messageConvertersProvider <span class="token operator">=</span> messageConvertersProvider<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>resourceHandlerRegistrationCustomizer <span class="token operator">=</span> resourceHandlerRegistrationCustomizerProvider<span class="token punctuation">.</span><span class="token function">getIfAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>dispatcherServletPath <span class="token operator">=</span> dispatcherServletPath<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>servletRegistrations <span class="token operator">=</span> servletRegistrations<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">checkConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre></div><p><strong>2、静态资源处理的默认规则</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">isAddMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Default resource handling disabled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     <span class="token comment">//webjars的规则</span>
    <span class="token function">addResourceHandler</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token string">&quot;/webjars/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath:/META-INF/resources/webjars/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//classpath路径下的规则</span>
    <span class="token function">addResourceHandler</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>       		    registration<span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>servletContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServletContextResource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletContextResource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>servletContext<span class="token punctuation">,</span> SERVLET_LOCATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registration<span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第一个if(!this.resourceProperties.isAddMappings())对应的配置</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#禁用所有静态资源规则</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">add-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>   
</code></pre></div><p><strong>3、欢迎页的处理规则</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//处理欢迎页的bean</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WelcomePageHandlerMapping</span> <span class="token function">welcomePageHandlerMapping</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">,</span><span class="token class-name">FormattingConversionService</span> mvcConversionService<span class="token punctuation">,</span> <span class="token class-name">ResourceUrlProvider</span> mvcResourceUrlProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">WelcomePageHandlerMapping</span> welcomePageHandlerMapping <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WelcomePageHandlerMapping</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TemplateAvailabilityProviders</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">,</span> applicationContext<span class="token punctuation">,</span> <span class="token function">getWelcomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    welcomePageHandlerMapping<span class="token punctuation">.</span><span class="token function">setInterceptors</span><span class="token punctuation">(</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>mvcConversionService<span class="token punctuation">,</span> mvcResourceUrlProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    welcomePageHandlerMapping<span class="token punctuation">.</span><span class="token function">setCorsConfigurations</span><span class="token punctuation">(</span><span class="token function">getCorsConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> welcomePageHandlerMapping<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>new WelcomePageHandlerMapping（）的过程</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">WelcomePageHandlerMapping</span><span class="token punctuation">(</span><span class="token class-name">TemplateAvailabilityProviders</span> templateAvailabilityProviders<span class="token punctuation">,</span>
			<span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">,</span> <span class="token class-name">Resource</span> welcomePage<span class="token punctuation">,</span> <span class="token class-name">String</span> staticPathPattern<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//要用欢迎页功能，必须是/**</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>welcomePage <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;/**&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Adding welcome page: &quot;</span> <span class="token operator">+</span> welcomePage<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">setRootViewName</span><span class="token punctuation">(</span><span class="token string">&quot;forward:index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">welcomeTemplateExists</span><span class="token punctuation">(</span>templateAvailabilityProviders<span class="token punctuation">,</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 调用Controller  /index</span>
			logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Adding welcome page template: index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">setRootViewName</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3、请求参数处理"><a href="#_3、请求参数处理" class="header-anchor">#</a> 3、请求参数处理</h3> <h4 id="_3-1-请求映射"><a href="#_3-1-请求映射" class="header-anchor">#</a> 3.1，请求映射</h4> <h5 id="_3-1-1-rest使用与原理"><a href="#_3-1-1-rest使用与原理" class="header-anchor">#</a> <strong>3.1.1，rest使用与原理</strong></h5> <ul><li><p>@xxxMapping；</p></li> <li><p>Rest风格支持（<em>使用<strong>HTTP</strong>请求方式动词来表示对资源的操作</em>）</p> <p>以前：/getUser  获取用户    /deleteUser 删除用户   /editUser  修改用户      /saveUser 保存用户</p> <p>现在： /user    GET-获取用户    DELETE-删除用户     PUT-修改用户      POST-保存用户</p> <p>核心Filter；<strong>HiddenHttpMethodFilter</strong></p> <p>用法： 表单method=post，隐藏域 _method=put(get和post不用)</p> <p>SpringBoot中手动开启</p></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">hiddenmethod</span><span class="token punctuation">:</span>
      <span class="token key atrule">filter</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>   <span class="token comment">#开启页面表单的Rest功能</span>
</code></pre></div><p><strong>1，示例</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;GET-张三&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//表单部分</span>
<span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input name<span class="token operator">=</span><span class="token string">&quot;_method&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;delete&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre></div><p><strong>2，源码分析</strong></p> <p>主要处理的bean</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">HiddenHttpMethodFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.mvc.hiddenmethod.filter&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">OrderedHiddenHttpMethodFilter</span> <span class="token function">hiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OrderedHiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>具体处理方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpServletRequest</span> requestToUse <span class="token operator">=</span> request<span class="token punctuation">;</span>
    <span class="token comment">//方法为post时才会判断，也对应上面的表单method=post，隐藏域 _method=put</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.exception&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//获取_method的值</span>
            <span class="token class-name">String</span> paramValue <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>methodParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>paramValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//转为大写，所以表单中大小写任意</span>
                <span class="token class-name">String</span> method <span class="token operator">=</span> paramValue<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>ENGLISH<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ALLOWED_METHODS<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    requestToUse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HiddenHttpMethodFilter<span class="token punctuation">.</span>HttpMethodRequestWrapper</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span><span class="token punctuation">)</span>requestToUse<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong>3，总结</strong></p> <p>Rest原理（表单提交要使用REST的时候）</p> <ul><li><p>表单提交会带上**_method=PUT**</p></li> <li><p><strong>请求过来被</strong>HiddenHttpMethodFilter拦截</p> <p>请求是否正常，并且是POST</p> <p>获取到**_method**的值。</p> <p>兼容以下请求；<strong>PUT</strong>.<strong>DELETE</strong>.<strong>PATCH</strong></p> <p><strong>原生request（post），包装模式requesWrapper重写了getMethod方法，返回的是传入的值。</strong></p> <p><strong>过滤器链放行的时候用wrapper。以后的方法调用getMethod是调用requesWrapper的。</strong></p></li></ul> <p><strong>4，Rest使用客户端工具，</strong></p> <ul><li>如PostMan直接发送Put、delete等方式请求，无需Filter。</li></ul> <p><strong>5，扩展</strong>：</p> <p>如何把_method 这个名字换成我们自己喜欢的。</p> <p>自定义配置类HiddenHttpMethodFilter即可</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//自定义filter</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HiddenHttpMethodFilter</span> <span class="token function">hiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">HiddenHttpMethodFilter</span> methodFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        methodFilter<span class="token punctuation">.</span><span class="token function">setMethodParam</span><span class="token punctuation">(</span><span class="token string">&quot;_m&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> methodFilter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h5 id="_3-1-2-请求映射原理"><a href="#_3-1-2-请求映射原理" class="header-anchor">#</a> <strong>3.1.2，请求映射原理</strong></h5> <p><img src="https://github.com/jack110959/pictures/blob/main/img%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86.png?raw=true" alt="请求映射类">SpringMVC功能分析都从 org.springframework.web.servlet.DispatcherServlet --》 doDispatch（）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doDispatch</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpServletRequest</span> processedRequest <span class="token operator">=</span> request<span class="token punctuation">;</span>
        <span class="token class-name">HandlerExecutionChain</span> mappedHandler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> multipartRequestParsed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">WebAsyncManager</span> asyncManager <span class="token operator">=</span> <span class="token class-name">WebAsyncUtils</span><span class="token punctuation">.</span><span class="token function">getAsyncManager</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> dispatchException <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    processedRequest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkMultipart</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    multipartRequestParsed <span class="token operator">=</span> processedRequest <span class="token operator">!=</span> request<span class="token punctuation">;</span>
                    <span class="token comment">// 找到当前请求使用哪个Handler（Controller的方法）处理</span>
                    mappedHandler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>查找映射的方法getHandler（）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
    <span class="token keyword">protected</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Iterator</span> var2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>var2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">HandlerMapping</span> mapping <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMapping</span><span class="token punctuation">)</span>var2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">HandlerExecutionChain</span> handler <span class="token operator">=</span> mapping<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> handler<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

</code></pre></div><p>handlerMappings的所有种类</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSpringBootHandlerMappings.png?raw=true" alt="handlerMappings"></p> <p><strong>RequestMappingHandlerMapping</strong>：保存了所有@RequestMapping 和handler的映射规则。</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSpringBootRequestMappingHandlerMapping.png?raw=true" alt="RequestMappingHandlerMapping"></p> <p>所有的请求映射都在HandlerMapping中。</p> <ul><li><p>SpringBoot自动配置欢迎页的 WelcomePageHandlerMapping 。访问 /能访问到index.html；</p></li> <li><p>SpringBoot自动配置了默认 的 RequestMappingHandlerMapping</p></li> <li><p>请求进来，挨个尝试所有的HandlerMapping看是否有请求信息。</p></li> <li><ul><li>如果有就找到这个请求对应的handler</li> <li>如果没有就是下一个 HandlerMapping</li></ul></li> <li><p>我们需要一些自定义的映射处理，我们也可以自己给容器中放<strong>HandlerMapping</strong>。自定义 <strong>HandlerMapping</strong></p></li></ul> <h4 id="_3-2、普通参数与基本注解"><a href="#_3-2、普通参数与基本注解" class="header-anchor">#</a> 3.2、普通参数与基本注解</h4> <h5 id="_3-2-1、注解"><a href="#_3-2-1、注解" class="header-anchor">#</a> 3.2.1、注解</h5> <p>@PathVariable、@RequestHeader、@RequestParam、@CookieValue,@RequestAttribute</p> <p>@ModelAttribute，被<code>@ModelAttribute</code>注释的方法会在此<code>controller</code>每个方法执行前被执行，因此对于一个controller映射多个URL的用法来说，要谨慎使用。<a href="https://juejin.cn/post/6844903734888103943" target="_blank" rel="noopener noreferrer">了解更多<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>@RequestBody主要用来接收前端传递给后端的json字符串中的数据的(请求体中的数据的);GET方式无请求体，所以使用@RequestBody接收数据时，前端不能使用GET方式提交数据，而是用POST方式进行提交.</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/car/{id}/owner/{username}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCar</span><span class="token punctuation">(</span>
               <span class="token comment">//绑定url中{}的数据</span>
               <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span>
               <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>
               <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> pv<span class="token punctuation">,</span>
               <span class="token comment">//绑定请求头</span>
               <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userAgent<span class="token punctuation">,</span>
               <span class="token annotation punctuation">@RequestHeader</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> header<span class="token punctuation">,</span>
               <span class="token comment">//将theage的数据绑定到age</span>
               <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;theage&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> age<span class="token punctuation">,</span>
               <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;inters&quot;</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> inters<span class="token punctuation">,</span>
               <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span>
               <span class="token comment">//绑定cookie</span>
               <span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span><span class="token string">&quot;_ga&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> _ga<span class="token punctuation">,</span>
               <span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span><span class="token string">&quot;_ga&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Cookie</span> cookie
               <span class="token comment">//绑定转发过来的请求中request中的数据</span>
               <span class="token comment">//也可用request.getAttribute(&quot;msg&quot;);直接获取</span>
               <span class="token annotation punctuation">@RequestAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> msg
               <span class="token comment">//绑定请求体</span>
               <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p><strong>@MatrixVariable</strong></p> <p>1、语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd    (使用分号隔开)</p> <p>2、SpringBoot默认是禁用了矩阵变量的功能</p> <p>​     手动开启：原理。对于路径的处理。UrlPathHelper进行解析。</p> <p>​             removeSemicolonContent（移除分号内容）支持矩阵变量的</p> <p>3、矩阵变量必须有url路径变量才能被解析。<a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=31" target="_blank" rel="noopener noreferrer">了解更多<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/cars/{path}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">carsSell</span><span class="token punctuation">(</span><span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span><span class="token string">&quot;low&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> low<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span><span class="token string">&quot;brand&quot;</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> brand<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> path<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;low&quot;</span><span class="token punctuation">,</span>low<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;brand&quot;</span><span class="token punctuation">,</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h5 id="_3-2-2、servlet-api"><a href="#_3-2-2、servlet-api" class="header-anchor">#</a> 3.2.2、Servlet API：</h5> <p>WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId</p> <p><strong>源码中的参数解析器</strong></p> <p>如果在控制层方法的形参中使用这些api(部分)，在底层的参数解析器为</p> <p><strong>ServletRequestMethodArgumentResolver</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//判断是否支持解析参数</span>
<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supportsParameter</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> paramType <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">WebRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">ServletRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">MultipartRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">HttpSession</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token punctuation">(</span>pushBuilder <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> pushBuilder<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token punctuation">(</span><span class="token class-name">Principal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>parameter<span class="token punctuation">.</span><span class="token function">hasParameterAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">InputStream</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">Reader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>paramType<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> paramType <span class="token operator">||</span>
				<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> paramType <span class="token operator">||</span>
				<span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> paramType <span class="token operator">||</span>
				<span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> paramType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><h5 id="_3-2-3、复杂参数"><a href="#_3-2-3、复杂参数" class="header-anchor">#</a> 3.2.3、复杂参数</h5> <p><strong>Map</strong>、<strong>Model（map、model里面的数据会被放在request的请求域  request.setAttribute）</strong></p> <p><strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong></p> <p>Errors/BindingResult、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">,</span>  <span class="token class-name">Model</span> model<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request 都是可以给request域中放数据，
request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取数据</span>
</code></pre></div><p><strong>Map、Model类型的参数</strong>，会返回 mavContainer.getModel（）；---&gt; BindingAwareModelMap 是Model 也是Map</p> <p><strong>mavContainer</strong>.getModel(); 获取到值的</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModelAndViewContainer</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> ignoreDefaultModelOnRedirect <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> view<span class="token punctuation">;</span>
    <span class="token comment">//方法返回下面对象</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ModelMap</span> defaultModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BindingAwareModelMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><img src="https://github.com/jack110959/pictures/blob/main/imgimage-20211016150401496.png?raw=true" alt="image-20211016150401496" style="zoom:150%;"> <p>1：model</p> <p>2：map</p> <p>处理后两个参数如下</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgimage-20211016150851823.png?raw=true" alt="image-20211016150851823"></p> <h4 id="_3-3、参数处理原理"><a href="#_3-3、参数处理原理" class="header-anchor">#</a> 3.3、参数处理原理</h4> <ul><li><p>HandlerMapping中找到能处理请求的Handler（Controller.method()）</p></li> <li><p>为当前Handler 找一个适配器 HandlerAdapter； <strong>RequestMappingHandlerAdapter</strong></p></li> <li><p>适配器执行目标方法并确定方法参数的每一个值</p></li></ul> <h5 id="_3-3-1、handleradapter"><a href="#_3-3-1、handleradapter" class="header-anchor">#</a> 3.3.1、HandlerAdapter</h5> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSpringBootHandlerAdapter.PNG?raw=true" alt="HandlerAdapter"></p> <p>0 - 支持方法上标注@RequestMapping</p> <p>1 - 支持函数式编程的</p> <h5 id="_3-3-2、执行目标方法"><a href="#_3-3-2、执行目标方法" class="header-anchor">#</a> 3.3.2、执行目标方法</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Actually invoke the handler.</span>
<span class="token comment">//DispatcherServlet -- doDispatch</span>
mv <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//RequestMappingHandlerAdapter  -- handleInternal()方法中</span>
mav <span class="token operator">=</span> <span class="token function">invokeHandlerMethod</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> handlerMethod<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行目标方法</span>


<span class="token comment">//RequestMappingHandlerAdapter  --  invokeHandlerMethod</span>
<span class="token comment">//获取参数解析器</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolvers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
invocableMethod<span class="token punctuation">.</span><span class="token function">setHandlerMethodArgumentResolvers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolvers<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token comment">//获取返回值处理器</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>returnValueHandlers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> invocableMethod<span class="token punctuation">.</span><span class="token function">setHandlerMethodReturnValueHandlers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>returnValueHandlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

<span class="token comment">//获取到参数的解析器后的执行方法</span>
invocableMethod<span class="token punctuation">.</span><span class="token function">invokeAndHandle</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//ServletInvocableHandlerMethod --  invokeAndHandle()</span>
<span class="token comment">//具体实现控制层方法的代码</span>
<span class="token class-name">Object</span> returnValue <span class="token operator">=</span> <span class="token function">invokeForRequest</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> providedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//InvocableHandlerMethod  -- invokeForRequest()</span>
<span class="token comment">//获取方法的参数值</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token function">getMethodArgumentValues</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> providedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//完整getMethodArgumentValues方法在下面第5点</span>
</code></pre></div><h5 id="_3-3-3、参数解析器"><a href="#_3-3-3、参数解析器" class="header-anchor">#</a> 3.3.3、参数解析器</h5> <p><strong>HandlerMethodArgumentResolver</strong></p> <p>确定将要执行的目标方法的每一个参数的值是什么;</p> <p>SpringMVC目标方法能写多少种参数类型。取决于参数解析器。（总共26个）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerMethodArgumentResolverComposite</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerMethodArgumentResolver</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p><img src="https://github.com/jack110959/pictures/blob/main/imgimage-20211015202119598.png?raw=true" alt="image-20211015202119598"></p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgimage-20211015202543732.png?raw=true" alt="image-20211015202543732"></p> <p>两个方法</p> <ul><li>supportsParameter()判断当前解析器是否支持解析这种参数</li> <li>支持就调用 resolveArgument</li></ul> <h5 id="_3-3-4、返回值处理器"><a href="#_3-3-4、返回值处理器" class="header-anchor">#</a> 3.3.4、返回值处理器</h5> <p><img src="https://github.com/jack110959/pictures/blob/main/imgimage-20211016093906490.png?raw=true" alt="image-20211016093906490"></p> <h5 id="_3-3-5、如何确定目标方法每一个参数的值"><a href="#_3-3-5、如何确定目标方法每一个参数的值" class="header-anchor">#</a> 3.3.5、如何确定目标方法每一个参数的值</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//InvocableHandlerMethod.class</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getMethodArgumentValues</span><span class="token punctuation">(</span><span class="token class-name">NativeWebRequest</span> request<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> providedArgs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">MethodParameter</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameters <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMethodParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果方法中没有参数值直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> EMPTY_ARGS<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>parameters<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token comment">//将所有参数信息依次遍历判断</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameters<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">MethodParameter</span> parameter <span class="token operator">=</span> parameters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
 parameter<span class="token punctuation">.</span><span class="token function">initParameterNameDiscovery</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parameterNameDiscoverer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">findProvidedArgument</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> providedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//判断参数解析器支不支持解析参数，具体看下面</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolvers<span class="token punctuation">.</span><span class="token function">supportsParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token function">formatArgumentError</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> <span class="token string">&quot;No suitable resolver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resolvers<span class="token punctuation">.</span><span class="token function">resolveArgument</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataBinderFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var10<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">String</span> exMsg <span class="token operator">=</span> var10<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>exMsg <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>exMsg<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getExecutable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toGenericString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token function">formatArgumentError</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> exMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>

                        <span class="token keyword">throw</span> var10<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> args<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong>先挨个判断所有参数解析器那个支持解析这个参数</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
    <span class="token keyword">private</span> <span class="token class-name">HandlerMethodArgumentResolver</span> <span class="token function">getArgumentResolver</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HandlerMethodArgumentResolver</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMethodArgumentResolver</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolverCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Iterator</span> var3 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolvers<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>var3<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">HandlerMethodArgumentResolver</span> resolver <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMethodArgumentResolver</span><span class="token punctuation">)</span>var3<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>resolver<span class="token punctuation">.</span><span class="token function">supportsParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> resolver<span class="token punctuation">;</span>
                    <span class="token comment">//加入缓存，下次就不用再依次遍历解析器</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolverCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> resolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong>最后解析这个参数的值</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>调用各自 <span class="token class-name">HandlerMethodArgumentResolver</span> 的 resolveArgument 方法即可
</code></pre></div><p><strong>解析自定义类型参数(封装POJO)的过程</strong></p> <p>首先找到解析器</p> <p><code>ServletModelAttributeMethodProcessor</code>  这个参数处理器支持</p> <p>选择依据：是否为简单类型。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isSimpleValueType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Void</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">!=</span> type <span class="token operator">&amp;&amp;</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">!=</span> type <span class="token operator">&amp;&amp;</span>
				<span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPrimitiveOrWrapper</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">CharSequence</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">Number</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token class-name">Temporal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span>
				URI<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span>
				URL<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span>
				<span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span>
				<span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>然后调用resolveArgument</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token function">resolveArgument</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span>
			<span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">WebDataBinderFactory</span> binderFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>mavContainer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;ModelAttributeMethodProcessor requires ModelAndViewContainer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>binderFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;ModelAttributeMethodProcessor requires WebDataBinderFactory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token class-name">ModelFactory</span><span class="token punctuation">.</span><span class="token function">getNameForParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ModelAttribute</span> ann <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">getParameterAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ModelAttribute</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ann <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mavContainer<span class="token punctuation">.</span><span class="token function">setBinding</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> ann<span class="token punctuation">.</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token class-name">Object</span> attribute <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">BindingResult</span> bindingResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mavContainer<span class="token punctuation">.</span><span class="token function">containsAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			attribute <span class="token operator">=</span> mavContainer<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// Create attribute instance</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//得到一个pojo的空对象</span>
				attribute <span class="token operator">=</span> <span class="token function">createAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> binderFactory<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BindException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBindExceptionRequired</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// No BindingResult parameter -&gt; fail with BindException</span>
					<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// Otherwise, expose null/empty value and associated BindingResult</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					attribute <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				bindingResult <span class="token operator">=</span> ex<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bindingResult <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Bean property binding and validation;</span>
			<span class="token comment">// skipped in case of binding failure on construction.</span>
            <span class="token comment">//创建一个参数绑定器</span>
			<span class="token class-name">WebDataBinder</span> binder <span class="token operator">=</span> binderFactory<span class="token punctuation">.</span><span class="token function">createBinder</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> attribute<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>binder<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mavContainer<span class="token punctuation">.</span><span class="token function">isBindingDisabled</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//进行绑定</span>
					<span class="token function">bindRequestParameters</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token function">validateIfApplicable</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>binder<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isBindExceptionRequired</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BindException</span><span class="token punctuation">(</span>binder<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// Value type adaptation, also covering java.util.Optional</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parameter<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInstance</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				attribute <span class="token operator">=</span> binder<span class="token punctuation">.</span><span class="token function">convertIfNecessary</span><span class="token punctuation">(</span>binder<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parameter<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			bindingResult <span class="token operator">=</span> binder<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Add resolved attribute and BindingResult at the end of the model</span>
		<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> bindingResultModel <span class="token operator">=</span> bindingResult<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mavContainer<span class="token punctuation">.</span><span class="token function">removeAttributes</span><span class="token punctuation">(</span>bindingResultModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mavContainer<span class="token punctuation">.</span><span class="token function">addAllAttributes</span><span class="token punctuation">(</span>bindingResultModel<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> attribute<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);</p> <p>WebDataBinder :web数据绑定器，将请求参数的值绑定到指定的JavaBean里面</p> <p>WebDataBinder 利用它里面的 Converters 将请求数据转成指定的数据类型。再次封装到JavaBean中</p> <p>GenericConversionService：在设置每一个值的时候，找它里面的所有converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（JavaBean -- Integer）</p> <p>byte -- &gt; file</p> <p>@FunctionalInterface<strong>public interface</strong> Converter&lt;S, T&gt;，默认总共124个转换器</p> <p><img src="https://github.com/jack110959/pictures/blob/main/img%E5%8F%82%E6%95%B0%E8%BD%AC%E6%8D%A2%E5%99%A8.png?raw=true" alt="参数转换器"></p> <p>未来我们可以给WebDataBinder里面放自己的Converter；</p> <p><strong>private static final class</strong> StringToNumber&lt;T <strong>extends</strong> Number&gt; <strong>implements</strong> Converter&lt;String, T&gt;</p> <p>自定义 Converter</p> <p>两种写法</p> <p>第一种，配置类实现WebMvcConfigurer接口，然后重写对应的方法addFormatters(可参考拦截器注册)</p> <p>第二种，直接添加一个WebMvcConfigurer组件，并返回一个重写了对应方法的WebMvcConfigurer对象。</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">//1、WebMvcConfigurer定制化SpringMVC的功能</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">webMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFormatters</span><span class="token punctuation">(</span><span class="token class-name">FormatterRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                registry<span class="token punctuation">.</span><span class="token function">addConverter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 啊猫,3</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token class-name">Pet</span> pet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            pet<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            pet<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span> pet<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h5 id="_3-3-6、目标方法执行完成"><a href="#_3-3-6、目标方法执行完成" class="header-anchor">#</a> 3.3.6、目标方法执行完成</h5> <p>将所有的数据都放在 <strong>ModelAndViewContainer</strong>；包含要去的页面地址View。还包含Model数据。</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgimage-20211016151443522.png?raw=true" alt="image-20211016151443522"></p> <h5 id="_3-3-7、处理派发结果"><a href="#_3-3-7、处理派发结果" class="header-anchor">#</a> 3.3.7、处理派发结果</h5> <p><strong>开始处理</strong></p> <p>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</p> <p><strong>模板解析</strong></p> <p>renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">InternalResourceView</span>：
<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">renderMergedOutputModel</span><span class="token punctuation">(</span>
			<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

		<span class="token comment">// Expose the model object as request attributes.</span>
		<span class="token function">exposeModelAsRequestAttributes</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Expose helpers as request attributes, if any.</span>
		<span class="token function">exposeHelpers</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Determine the path for the request dispatcher.</span>
		<span class="token class-name">String</span> dispatcherPath <span class="token operator">=</span> <span class="token function">prepareForRendering</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Obtain a RequestDispatcher for the target resource (typically a JSP).</span>
		<span class="token class-name">RequestDispatcher</span> rd <span class="token operator">=</span> <span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> dispatcherPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>rd <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServletException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not get RequestDispatcher for [&quot;</span> <span class="token operator">+</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
					<span class="token string">&quot;]: Check that the corresponding file exists within your web application archive!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// If already included or response already committed, perform include, else forward.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">useInclude</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Including [&quot;</span> <span class="token operator">+</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			rd<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// Note: The forwarded resource is supposed to determine the content type itself.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Forwarding to [&quot;</span> <span class="token operator">+</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			rd<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code>暴露模型作为请求域属性
<span class="token comment">// Expose the model object as request attributes.</span>
<span class="token function">exposeModelAsRequestAttributes</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>存放数据到请求域中</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">exposeModelAsRequestAttributes</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">,</span>
			<span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token comment">//model中的所有数据遍历挨个放在请求域中</span>
		model<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				request<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4、数据响应与内容协商"><a href="#_4、数据响应与内容协商" class="header-anchor">#</a> 4、数据响应与内容协商</h3> <img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-26_12-52-07.png?raw=true" alt="响应数据" style="zoom:80%;"> <h4 id="_4-1、响应json"><a href="#_4-1、响应json" class="header-anchor">#</a> 4.1、响应JSON</h4> <h5 id="_4-1-1、jackson-jar-responsebody"><a href="#_4-1-1、jackson-jar-responsebody" class="header-anchor">#</a> 4.1.1、jackson.jar+@ResponseBody</h5> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

web场景自动引入了json场景
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>返回值解析器</strong></p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-26_19-51-34.png?raw=true" alt="返回值解析器"></p> <p><strong>第一步，返回值处理器开始处理返回值</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//ServletInvocableHandlerMethod.class  --&gt; invokeAndHandle()</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>returnValueHandlers<span class="token punctuation">.</span><span class="token function">handleReturnValue</span><span class="token punctuation">(</span>
    returnValue<span class="token punctuation">,</span> <span class="token function">getReturnValueType</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">)</span><span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>第二步，寻找返回值处理器</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleReturnValue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> returnValue<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span><span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span> <span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">//寻找返回值处理器</span>
    <span class="token class-name">HandlerMethodReturnValueHandler</span> handler <span class="token operator">=</span> <span class="token function">selectHandler</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown return value type: &quot;</span> <span class="token operator">+</span>                     returnType<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    handler<span class="token punctuation">.</span><span class="token function">handleReturnValue</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>第三步</strong>，在<strong>selectHandler</strong>方法中先判断是不是异步返回值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">boolean</span> isAsyncValue <span class="token operator">=</span> <span class="token function">isAsyncReturnValue</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>返回值处理器默认有以下两个方法</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-26_20-31-21.png?raw=true" alt="返回值处理器方法"></p> <p>supportsReturnType：返回值处理器判断是否支持这种类型返回值</p> <p>handleReturnValue：返回值处理器调用 handleReturnValue 进行处理</p> <p><strong>第四步</strong>，依次遍历所有返回值处理器，调用supportsReturnType方法判断，找到返回值处理器后返回，使用找到的<strong>处理器调用handleReturnValue方法</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//HandlerMethodReturnValueHandlerComposite --&gt;handleReturnValue</span>
handler<span class="token punctuation">.</span><span class="token function">handleReturnValue</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>第五步</strong>，以<strong>RequestResponseBodyMethodProcessor</strong>处理器为例，该处理器可以处理返回值标了**@ResponseBody** 注解的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//RequestResponseBodyMethodProcessor  	</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{</span>

    mavContainer<span class="token punctuation">.</span><span class="token function">setRequestHandled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ServletServerHttpRequest</span> inputMessage <span class="token operator">=</span> <span class="token function">createInputMessage</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ServletServerHttpResponse</span> outputMessage <span class="token operator">=</span> <span class="token function">createOutputMessage</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Try even with null return value. ResponseBodyAdvice could get involved.</span>
    <span class="token comment">// 使用消息转换器进行写出操作</span>
    <span class="token function">writeWithMessageConverters</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span> inputMessage<span class="token punctuation">,</span> outputMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>进入writeWithMessageConverters方法</p> <p><strong>利用 MessageConverters 进行处理 将数据写为json</strong></p> <p>1.内容协商（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-26_22-10-17.png?raw=true" alt="内容协商"></p> <p>2.服务器最终根据自己自身的能力，决定服务器能生产出什么样内容类型的数据，</p> <p>3.SpringMVC会挨个遍历所有容器底层的 HttpMessageConverter(下面有介绍) ，看谁能处理？</p> <ul><li>得到MappingJackson2HttpMessageConverter可以将对象写为json</li> <li>利用MappingJackson2HttpMessageConverter将对象转为json再写出去。</li></ul> <h5 id="_4-1-2、springmvc到底支持哪些返回值"><a href="#_4-1-2、springmvc到底支持哪些返回值" class="header-anchor">#</a> <strong>4.1.2、SpringMVC到底支持哪些返回值</strong></h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ModelAndView</span>
<span class="token class-name">Model</span>
<span class="token class-name">View</span>
<span class="token class-name">ResponseEntity</span> 
<span class="token class-name">ResponseBodyEmitter</span>
<span class="token class-name">StreamingResponseBody</span>
<span class="token class-name">HttpEntity</span>
<span class="token class-name">HttpHeaders</span>
<span class="token class-name">Callable</span>
<span class="token class-name">DeferredResult</span>
<span class="token class-name">ListenableFuture</span>
<span class="token class-name">CompletionStage</span>
<span class="token class-name">WebAsyncTask</span>
有 <span class="token annotation punctuation">@ModelAttribute</span> 且为对象类型的
<span class="token annotation punctuation">@ResponseBody</span> 注解 <span class="token operator">--</span><span class="token operator">-&gt;</span> <span class="token class-name">RequestResponseBodyMethodProcessor</span>；等
</code></pre></div><h5 id="_4-1-3、httpmessageconverter原理"><a href="#_4-1-3、httpmessageconverter原理" class="header-anchor">#</a> 4.1.3、HTTPMessageConverter原理</h5> <p><strong>接口规范</strong></p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-26_22-24-30.png?raw=true" alt="HTTPMessageConverter"></p> <p>HttpMessageConverter: 看是否支持将 此 <strong>Class</strong>类型的对象，转为<strong>MediaType</strong>类型的数据。</p> <p>例子：Person对象转为JSON。或者 JSON转为Person</p> <p><strong>默认的MessageConverter</strong></p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-26_22-40-37.png?raw=true" alt="MessageConverter"></p> <p>0 - 只支持Byte类型的</p> <p>1 - String</p> <p>2 - String</p> <p>3 - Resource</p> <p>4 - ResourceRegion</p> <p>5 - DOMSource.*<em>class *</em> SAXSource.<strong>class</strong>) \ StAXSource.**class **StreamSource.**class **Source.<strong>class</strong></p> <p><strong>6 -</strong> MultiValueMap</p> <p>7 - <strong>true</strong></p> <p><strong>8 - true</strong></p> <p><strong>9 - 支持注解方式xml处理的。(新版本移除了)</strong></p> <p>最终 MappingJackson2HttpMessageConverter  把对象转为JSON（利用底层的jackson的objectMapper转换的）</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-26_23-03-37.png?raw=true" alt="转换"></p> <h4 id="_4-2、内容协商"><a href="#_4-2、内容协商" class="header-anchor">#</a> 4.2、内容协商</h4> <p>根据客户端接收能力不同，返回不同媒体类型的数据。</p> <h5 id="_4-2-1、引入xml依赖"><a href="#_4-2-1、引入xml依赖" class="header-anchor">#</a> 4.2.1、引入xml依赖</h5> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.dataformat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-dataformat-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="_4-2-2、postman分别测试返回json和xml"><a href="#_4-2-2、postman分别测试返回json和xml" class="header-anchor">#</a> 4.2.2、postman分别测试返回json和xml</h5> <p>只需要改变请求头中Accept字段。Http协议中规定的，告诉服务器本客户端可以接收的数据类型。</p> <h5 id="_4-2-3、开启浏览器参数方式内容协商功能"><a href="#_4-2-3、开启浏览器参数方式内容协商功能" class="header-anchor">#</a> 4.2.3、开启浏览器参数方式内容协商功能</h5> <p>为了方便内容协商，开启基于请求参数的内容协商功能。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">#开启请求参数内容协商模式</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">contentnegotiation</span><span class="token punctuation">:</span>
      <span class="token key atrule">favor-parameter</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  
<span class="token comment">#是否应该使用请求参数(默认为“format”)来确定所请求的媒体类型</span>
</code></pre></div><p>所以在请求后台服务器数据时，可以通过添加请求参数<strong>format</strong>来确定要接收的数据格式</p> <p><strong>示例</strong></p> <p>发请求：</p> <p>http://localhost:8080/test/person?format=json</p> <p><a href="http://localhost:8080/test/person?format=json" target="_blank" rel="noopener noreferrer">http://localhost:8080/test/person?format=<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>xml</p> <p><strong>底层原理分析</strong></p> <p>在确定客户端接收什么样的内容类型步骤</p> <p>------开启请求参数内容协商模式后，底层的内容协商管理器多出一个<strong>format</strong>的strategy，默认的那个会返回请求头aceept中的媒体类型</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-28_14-29-58.png?raw=true" alt="内容协商管理器"></p> <p>------遍历strategies</p> <p>------Parameter策略优先确定是要返回json数据（获取请求头中的format的值）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第二个参数为获取请求参数format的值</span>
<span class="token keyword">return</span> <span class="token function">resolveMediaTypeKey</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> <span class="token function">getMediaTypeKey</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>-------最终进行内容协商返回给客户端json。</p> <h5 id="_4-2-4、内容协商原理"><a href="#_4-2-4、内容协商原理" class="header-anchor">#</a> 4.2.4、内容协商原理</h5> <p>从AbstractMessageConverterMethodProcessor.class的writeWithMessageConverters方法开始</p> <p>1，<strong>if (isContentTypePreset)</strong> 判断当前响应头中是否已经有确定的媒体类型。MediaType</p> <p>2，调用**getAcceptableMediaTypes(request)**获取客户端（PostMan、浏览器）支持接收的内容类型。（获取客户端Accept请求头字段）【application/xml】</p> <p>------contentNegotiationManager 内容协商管理器 默认使用基于请求头的策略</p> <p>------HeaderContentNegotiationStrategy  确定客户端可以接收的内容类型</p> <p>3、调用getProducibleMediaTypes方法得到服务器能够返回的媒体类型</p> <p>-----遍历循环所有当前系统的 MessageConverter，看谁支持操作这个对象（Person）</p> <p>------找到支持操作Person的converter，把converter支持的媒体类型统计出来。</p> <p>4，客户端需要【application/xml】。服务端能力【10种、json、xml】</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-27_16-53-25.png?raw=true" alt="服务端能力"></p> <p>5，进行内容协商的最佳匹配媒体类型,将所有支持的MediaTypes存入到mediaTypesToUse中</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-27_16-57-25.png?raw=true" alt="媒体类型匹配"></p> <p>6，遍历mediaTypesToUse，找到合适的MediaTypes，然后break</p> <p>7，遍历messageConverters，用支持将对象转为最佳匹配媒体类型 的converter。调用它进行转化 。</p> <h5 id="_4-2-5、自定义-messageconverter"><a href="#_4-2-5、自定义-messageconverter" class="header-anchor">#</a> 4.2.5、自定义 MessageConverter</h5> <p>为什么需要自定义MessageConverter，当我们想要让一些数据以我们自定义的格式返回，而不是普通的json或xml格式的数据。并且底层的最终是遍历MessageConverter，然后再进行数据转换的。</p> <p>所有我们只需要添加一个MessageConverter，在方法里面自定义我们自己的转换规则。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//需要注意，下面这种方法只能处理通过请求头设置accept的值，不能处理携带format的请求</span>
<span class="token comment">//老规矩，往容器添加一个WebMvcConfigurer，重写extendMessageConverters方法添加自定义MessageConverter</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">webMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">extendMessageConverters</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//自定义类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMessageConverter</span> <span class="token keyword">implements</span> <span class="token class-name">HttpMessageConverter</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><p>1，系统中MessageConverter的导入</p> <p>导入了jackson处理xml的包，xml的converter就会自动加载进来</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//WebMvcConfigurationSupport.class </span>
jackson2XmlPresent <span class="token operator">=</span>  <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span>isPresent             <span class="token punctuation">(</span><span class="token string">&quot;com.fasterxml.jackson.dataformat.xml.XmlMapper&quot;</span><span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//如果上面的条件成立</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>jackson2XmlPresent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Jackson2ObjectMapperBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">Jackson2ObjectMapperBuilder</span><span class="token punctuation">.</span><span class="token function">xml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">applicationContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    messageConverters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MappingJackson2XmlHttpMessageConverter</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2,实现多协议数据兼容。json、xml、x-kk(自定义)</p> <p>--@ResponseBody 响应数据出去 调用 <strong>RequestResponseBodyMethodProcessor</strong> 处理</p> <p>--Processor 处理方法返回值。通过 <strong>MessageConverter</strong> 处理</p> <p>--所有 <strong>MessageConverter</strong> 合起来可以支持各种媒体类型数据的操作（读、写）</p> <p>--内容协商找到最终的 <strong>messageConverter</strong>；</p> <p><a href="https://juejin.cn/post/7024382677667020831/" target="_blank" rel="noopener noreferrer">代码例子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>需要注意</strong>：有可能我们添加的自定义的功能会覆盖默认很多功能，导致一些默认的功能失效。</p> <h3 id="_5、视图解析与模板引擎"><a href="#_5、视图解析与模板引擎" class="header-anchor">#</a> 5、视图解析与模板引擎</h3> <p>视图解析：<strong>SpringBoot默认不支持 JSP，需要引入第三方模板引擎技术实现页面渲染。</strong></p> <h4 id="_5-1、视图解析"><a href="#_5-1、视图解析" class="header-anchor">#</a> 5.1、视图解析</h4> <img src="https://github.com/jack110959/pictures/blob/main/imgSpringBoot%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90.jpg?raw=true" alt="视图解析" style="zoom:80%;"> <h5 id="_5-1-1、视图解析原理流程"><a href="#_5-1-1、视图解析原理流程" class="header-anchor">#</a> 5.1.1、视图解析原理流程</h5> <p><strong>以返回值为重定向示例</strong></p> <p>1、目标方法处理的过程中，所有数据都会被放在 <strong>ModelAndViewContainer 里面。包括数据和视图地址</strong></p> <p><strong>2、方法的参数是一个自定义类型对象（从请求参数中确定的），把他重新放在</strong> <strong>ModelAndViewContainer</strong></p> <p><strong>3、任何目标方法执行完成以后都会返回 ModelAndView（数据和视图地址）。</strong></p> <p><strong>4、processDispatchResult  处理派发结果（页面该如何响应）</strong></p> <ul><li><p>1、<strong>render</strong>(<strong>mv</strong>, request, response); 进行页面渲染逻辑</p> <p>--1、根据方法的String返回值得到 <strong>View</strong> 对象【定义了页面的渲染逻</p> <p>-------1、所有的视图解析器(下图)尝试是否能根据当前返回值得到<strong>View</strong>对象</p></li></ul> <p><img src="https://github.com/jack110959/pictures/blob/main/img%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-10-17%20101913.png?raw=true" alt="视图解析器"></p> <p>​        -------2、得到了  <strong>redirect:/main.html</strong> --&gt; Thymeleaf解析器 new <strong>RedirectView</strong>()</p> <p>​		-------3、ContentNegotiationViewResolver 里面包含了下面所有的视图解析器，内部还是利用下面所有视图解析器得到视图对象。</p> <blockquote><p><img src="https://github.com/jack110959/pictures/blob/main/img%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-10-17%20104731.png?raw=true" alt="ContentNegotiationViewResolver"></p></blockquote> <p>​	  -------4、view.render(mv.getModelInternal(), request, response);   视图对象调用自定义的render进行页面渲染工作</p> <blockquote><p><img src="https://github.com/jack110959/pictures/blob/main/img%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-10-17%20112034.png?raw=true" alt="render"></p></blockquote> <p><strong>RedirectView 如何渲染【重定向到一个页面】(renderMergedOutputModel方法</strong></p> <p><strong>1、获取目标url地址</strong></p> <p><strong>2、response.sendRedirect(encodedURL);</strong></p> <p>**视图解析：**createView()</p> <ul><li><strong>返回值以 forward: 开始： new InternalResourceView(forwardUrl);</strong> --&gt;  <strong>转发</strong>request.getRequestDispatcher(path).forward(request, response);</li> <li><strong>返回值以</strong> <strong>redirect: 开始：</strong> <strong>new RedirectView() --》 render就是重定向</strong> <ul><li><strong>返回值是普通字符串： new ThymeleafView（）</strong></li></ul></li></ul> <h4 id="_5-2、模板引擎-thymeleaf"><a href="#_5-2、模板引擎-thymeleaf" class="header-anchor">#</a> 5.2、模板引擎-Thymeleaf</h4> <h5 id="_5-2-1、thymeleaf简介"><a href="#_5-2-1、thymeleaf简介" class="header-anchor">#</a> 5.2.1、thymeleaf简介</h5> <p>Thymeleaf is a modern server-side Java template engine for both web and standalone environments, capable of processing HTML, XML, JavaScript, CSS and even plain text.</p> <p><strong>现代化、服务端Java模板引擎</strong></p> <h5 id="_5-2-2、基本语法"><a href="#_5-2-2、基本语法" class="header-anchor">#</a> 5.2.2、基本语法</h5> <p><strong>1、表达式</strong></p> <table><thead><tr><th>表达式名字</th> <th>语法</th> <th>用途</th></tr></thead> <tbody><tr><td>变量取值</td> <td>${...}</td> <td>获取请求域、session域、对象等值</td></tr> <tr><td>选择变量</td> <td>*{...}</td> <td>获取上下文对象值</td></tr> <tr><td>消息</td> <td>#{...}</td> <td>获取国际化等值</td></tr> <tr><td>链接</td> <td>@{...}</td> <td>生成链接</td></tr> <tr><td>片段表达式</td> <td>~{...}</td> <td>jsp:include 作用，引入公共页面片段</td></tr></tbody></table> <p><strong>2、字面量</strong></p> <p>文本值: <strong>'one text'</strong> <strong>,</strong> <strong>'Another one!'</strong> **,…**数字: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> **,…**布尔值: <strong>true</strong> <strong>,</strong> <strong>false</strong></p> <p>空值: <strong>null</strong></p> <p>变量： one，two，.... 变量不能有空格</p> <p><strong>3、文本操作</strong></p> <p>字符串拼接: <strong>+</strong></p> <p>变量替换: <strong>|The name is ${name}|</strong></p> <p><strong>4、数学运算</strong></p> <p>运算符: + , - , * , / , %</p> <p><strong>5、布尔运算</strong></p> <p>运算符:  <strong>and</strong> <strong>,</strong> <strong>or</strong></p> <p>一元运算: <strong>!</strong> <strong>,</strong> <strong>not</strong></p> <p><strong>6、比较运算</strong></p> <p>比较: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;</strong> <strong>,</strong> <strong>&gt;=</strong> <strong>,</strong> <strong>&lt;=</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> **)**等式: <strong>==</strong> <strong>,</strong> <strong>!=</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong></p> <p><strong>7、条件运算</strong></p> <p>If-then: <strong>(if) ? (then)</strong></p> <p>If-then-else: <strong>(if) ? (then) : (else)</strong></p> <p>Default: (value) <strong>?: (defaultvalue)</strong></p> <h5 id="_5-2-3、设置属性值-th-attr"><a href="#_5-2-3、设置属性值-th-attr" class="header-anchor">#</a> 5.2.3、设置属性值-th:attr</h5> <p>设置单个值</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>subscribe.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>action=@{/subscribe}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Subscribe!<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value=#{subscribe.submit}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>设置多个值</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../../images/gtvglogo.png<span class="token punctuation">&quot;</span></span>  <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src=@{/images/gtvglogo.png},title=#{logo},alt=#{logo}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>以上两个的代替写法 th:xxxx</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Subscribe!<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#{subscribe.submit}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>subscribe.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/subscribe}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>所有h5兼容的标签写法</p> <p>https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</p> <h5 id="_5-2-4、迭代"><a href="#_5-2-4、迭代" class="header-anchor">#</a> 5.2.4、迭代</h5> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prod : ${prods}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${prod.name}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Onions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${prod.price}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2.41<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${prod.inStock}? #{true} : #{false}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prod,iterStat : ${prods}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${iterStat.odd}? <span class="token punctuation">'</span>odd<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${prod.name}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Onions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${prod.price}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2.41<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${prod.inStock}? #{true} : #{false}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="_5-2-5、条件运算"><a href="#_5-2-5、条件运算" class="header-anchor">#</a> 5.2.5、条件运算</h5> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comments.html<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/product/comments(prodId=${prod.id})}<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${not #lists.isEmpty(prod.comments)}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>switch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${user.role}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>admin<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>User is an administrator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#{roles.manager}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>User is a manager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>User is some other thing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="_5-2-6、属性优先级"><a href="#_5-2-6、属性优先级" class="header-anchor">#</a> 5.2.6、属性优先级</h5> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605498132699-4fae6085-a207-456c-89fa-e571ff1663da.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_44%2Ctext_YXRndWlndS5jb20g5bCa56GF6LC3%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10" alt="img"></p> <h4 id="_5-3、thymeleaf使用"><a href="#_5-3、thymeleaf使用" class="header-anchor">#</a> 5.3、thymeleaf使用</h4> <p><strong>1、引入Starter</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>2、自动配置好了thymeleaf</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ThymeleafProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">TemplateMode</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">SpringTemplateEngine</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">WebMvcAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebFluxAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThymeleafAutoConfiguration</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>自动配好的策略</p> <ul><li><p>1、所有thymeleaf的配置值都在 ThymeleafProperties</p></li> <li><p>2、配置好了 <strong>SpringTemplateEngine</strong></p></li> <li><p>3、配好了 <strong>ThymeleafViewResolver</strong></p></li> <li><p>4、我们只需要直接开发页面</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//ThymeleafProperties</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DEFAULT_PREFIX <span class="token operator">=</span> <span class="token string">&quot;classpath:/templates/&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DEFAULT_SUFFIX <span class="token operator">=</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>3、页面开发</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 注意需要添加xmlns:th=&quot;http://www.thymeleaf.org&quot;才能生效 --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${msg}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>哈哈<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>www.atguigu.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${link}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去百度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>www.atguigu.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{link}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去百度2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_5-4、构建后台管理系统"><a href="#_5-4、构建后台管理系统" class="header-anchor">#</a> 5.4、构建后台管理系统</h4> <h6 id="_1、项目创建"><a href="#_1、项目创建" class="header-anchor">#</a> 1、项目创建</h6> <p>thymeleaf、web-starter、devtools、lombok</p> <h6 id="_2、静态资源处理"><a href="#_2、静态资源处理" class="header-anchor">#</a> 2、静态资源处理</h6> <p>自动配置好，我们只需要把所有静态资源放到 static 文件夹下</p> <h6 id="_3、路径构建"><a href="#_3、路径构建" class="header-anchor">#</a> 3、路径构建</h6> <p>th:action=&quot;@{/login}&quot;</p> <h6 id="_4、模板抽取"><a href="#_4、模板抽取" class="header-anchor">#</a> 4、模板抽取</h6> <p>th:insert/replace/include</p> <p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#expression-inlining" target="_blank" rel="noopener noreferrer">了解更多<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h6 id="_5、页面跳转"><a href="#_5、页面跳转" class="header-anchor">#</a> 5、页面跳转</h6> <div class="language-Java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//把登陆成功的用户保存起来</span>
            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;loginUser&quot;</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//登录成功重定向到main.html;  重定向防止表单重复提交</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:/main.html&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;账号密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//回到登录页面</span>
            <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre></div><h6 id="_6、数据渲染"><a href="#_6、数据渲染" class="header-anchor">#</a> 6、数据渲染</h6> <div class="language-Java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/dynamic_table&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">dynamic_table</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//表格内容的遍历</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123444&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;haha&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aaaaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;hehe &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aaddd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token string">&quot;table/dynamic_table&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><div class="language-HTML extra-class"><pre class="language-html"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>display table table-bordered<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden-table-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>#<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gradeX<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user,stats:${users}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${stats.count}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Trident<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${user.userName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Internet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token punctuation">&gt;</span></span>[[${user.password}]]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_6、拦截器"><a href="#_6、拦截器" class="header-anchor">#</a> 6、拦截器</h3> <h4 id="_6-1、handlerinterceptor-接口"><a href="#_6-1、handlerinterceptor-接口" class="header-anchor">#</a> 6.1、HandlerInterceptor 接口</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 登录检查
 * 1、配置好拦截器要拦截哪些请求
 * 2、把这些配置放在容器中
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 目标方法执行之前
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> requestURI <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;preHandle拦截的请求路径是{}&quot;</span><span class="token punctuation">,</span>requestURI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//登录检查逻辑</span>
        <span class="token class-name">Object</span> loginUser <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;loginUser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>loginUser <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//放行</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//拦截住。未登录。跳转到登录页</span>
        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;请先登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        re.sendRedirect(&quot;/&quot;);</span>
        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 目标方法执行完成以后，页面渲染以前
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;postHandle执行{}&quot;</span><span class="token punctuation">,</span>modelAndView<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 页面渲染以后
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;afterCompletion执行异常{}&quot;</span><span class="token punctuation">,</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-2、配置拦截器"><a href="#_6-2、配置拦截器" class="header-anchor">#</a> 6.2、配置拦截器</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 1、编写一个拦截器实现HandlerInterceptor接口
 * 2、拦截器注册到容器中（实现WebMvcConfigurer的addInterceptors）
 * 3、指定拦截规则【如果是拦截所有，静态资源也会被拦截】
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminWebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//添加拦截器</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>  <span class="token comment">//所有请求都被拦截包括静态资源 </span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/css/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/fonts/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/images/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/js/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">//放行的请求</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-3、拦截器原理"><a href="#_6-3、拦截器原理" class="header-anchor">#</a> 6.3、拦截器原理</h4> <p>1、根据当前请求，找到**HandlerExecutionChain【**可以处理请求的handler以及handler的所有拦截器】</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-17_16-03-01.png?raw=true" alt="HandlerExecutionChain"></p> <p>2、先来<strong>顺序执行</strong> 所有拦截器的 preHandle方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//源码</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mappedHandler<span class="token punctuation">.</span><span class="token function">applyPreHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>1、如果当前拦截器prehandler返回为true。则执行下一个拦截器的preHandle</li> <li>2、如果当前拦截器返回为false。直接倒序执行所有已经执行了的拦截器的  afterCompletion；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">boolean</span> <span class="token function">applyPreHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>interceptor<span class="token punctuation">.</span><span class="token function">preHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//倒序执行拦截器的 afterCompletion</span>
				<span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>interceptorIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>3、如果任何一个拦截器返回false。直接跳出不执行目标方法</strong></p> <p><strong>4、所有拦截器都返回True。执行目标方法</strong></p> <p><strong>5、倒序执行所有拦截器的postHandle方法。</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>mappedHandler<span class="token punctuation">.</span><span class="token function">applyPostHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>6、前面的步骤有任何异常都会直接倒序触发</strong> afterCompletion</p> <p>7、页面成功渲染完成以后，也会倒序触发 afterCompletion</p> <p><strong>具体流程如下</strong></p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-17_16-29-56.png?raw=true" alt="具体流程"></p> <h3 id="_7、文件上传"><a href="#_7、文件上传" class="header-anchor">#</a> 7、文件上传</h3> <h4 id="_7-1、页面表单"><a href="#_7-1、页面表单" class="header-anchor">#</a> 7.1、页面表单</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 必须为post方法(因为get请求不能设置enctype)，并且需要设置enctype   --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>headerImg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--单文件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>photos<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiple</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--多文件(multiple)--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>enctype：主要是用来设置请求头<strong>Content-Type</strong>的。</p> <p><strong>Content-Type</strong></p> <p><strong>作用</strong>： Content-Type本质上是http的请求头中的一个设置，作用是发起http请求时，设置提交数据的格式和编码</p> <p><strong>共4种</strong></p> <ol><li><strong>application/x-www-form-urlencoded</strong>（默认值，又名url编码方式）</li> <li><strong>multipart/form-data</strong>（又名多部分表单格式），用于向服务器发送大量的数据，常用语图片上传和文件上传，它既可以发送文本数据，也支持二进制数据上传。</li> <li><strong>application/json（json格式</strong>），作用，用于提交json数据(json数据本质是json格式的字符串)</li> <li><strong>text/plain</strong>（又名普通文本格式）</li></ol> <p><strong>注意点</strong></p> <p>get请求没有这个请求头，不能手动设置。虽然get请求没有这个请求头，但是get请求使用默认的application/x-www-form-urlencoded的方式进行传递数据，post请求有这个请求头，并且可以手动设置进行更改默认的application/x-www-form-urlencoded，（使用ajax也一样）</p> <p><strong>源码中判断文件请求的方法</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isMultipart</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">startsWithIgnoreCase</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>strictServletCompliance <span class="token operator">?</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span>MULTIPART_FORM_DATA_VALUE <span class="token operator">:</span> <span class="token string">&quot;multipart/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://blog.csdn.net/qq_38753623/article/details/79280120" target="_blank" rel="noopener noreferrer">了解更多Content-Type<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_7-2、文件上传代码"><a href="#_7-2、文件上传代码" class="header-anchor">#</a> 7.2、文件上传代码</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">&quot;headerImg&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> headerImg<span class="token punctuation">,</span>
                     <span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">&quot;photos&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span><span class="token punctuation">[</span><span class="token punctuation">]</span> photos<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//单文件</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>headerImg<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//保存到文件服务器，OSS服务器</span>
            <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> headerImg<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            headerImg<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;H:\\cache\\&quot;</span><span class="token operator">+</span>originalFilename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//多文件</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>photos<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> photo <span class="token operator">:</span> photos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>photo<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> photo<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//记得先创建文件夹</span>
                    photo<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;H:\\cache\\&quot;</span><span class="token operator">+</span>originalFilename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="_7-3、设置上传文件大小"><a href="#_7-3、设置上传文件大小" class="header-anchor">#</a> 7.3、设置上传文件大小</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
      <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span> 10MB      <span class="token comment">#单文件的最大值</span>
      <span class="token key atrule">max-request-size</span><span class="token punctuation">:</span> 100MB  <span class="token comment">#一次请求的文件最大值</span>
</code></pre></div><h4 id="_7-4、自动配置原理"><a href="#_7-4、自动配置原理" class="header-anchor">#</a> 7.4、自动配置原理</h4> <p><strong>文件上传自动配置类-MultipartAutoConfiguration-</strong> <strong>MultipartProperties</strong></p> <p>自动配置好了 <strong>StandardServletMultipartResolver   【文件上传解析器】</strong></p> <p><strong>原理步骤</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>doDispatch  <span class="token operator">--</span><span class="token operator">&gt;</span>processedRequest <span class="token operator">=</span> <span class="token function">checkMultipart</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开始</span>
</code></pre></div><p><strong>1、请求进来使用文件上传解析器判断（<strong>isMultipart方法</strong>）并封装（<strong>resolveMultipart方法，<strong>返回</strong>MultipartHttpServletRequest</strong>）文件上传请求</strong></p> <p><strong>2、参数解析器来解析请求中的文件内容封装成MultipartFile</strong></p> <p>**3、将request中文件信息封装为一个Map；**MultiValueMap&lt;String, MultipartFile&gt;</p> <p><strong>FileCopyUtils</strong>。实现文件流的拷贝</p> <h3 id="_8、异常处理"><a href="#_8、异常处理" class="header-anchor">#</a> 8、异常处理</h3> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.spring-mvc.error-handling" target="_blank" rel="noopener noreferrer">官网介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_8-1、错误处理"><a href="#_8-1、错误处理" class="header-anchor">#</a> 8.1、错误处理</h4> <h5 id="_8-1-1、默认规则"><a href="#_8-1-1、默认规则" class="header-anchor">#</a> 8.1.1、默认规则</h5> <ul><li>默认情况下，Spring Boot提供<code>/error</code>处理所有错误的映射</li> <li>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据</li></ul> <p><strong>JSON响应</strong></p> <img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-18_10-47-38.png?raw=true" alt="json" style="zoom:80%;"> <p><strong>“ whitelabel”错误视图</strong></p> <img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-18_10-49-46.png?raw=true" alt="错误页面" style="zoom:50%;"> <ul><li><p><strong>要对其进行自定义，添加View解析为error</strong></p></li> <li><p>要完全替换默认行为，可以实现 <code>ErrorController</code>并注册该类型的Bean定义，或添加<code>ErrorAttributes类型的组件</code>以使用现有机制但替换其内容。</p></li> <li><p>error/下的4xx，5xx页面会被自动解析；</p></li></ul> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-18_10-59-45.png?raw=true" alt="错误页面路径"></p> <h4 id="_8-2、定制错误处理方法"><a href="#_8-2、定制错误处理方法" class="header-anchor">#</a> 8.2、定制错误处理方法</h4> <p>2到4，每个方法对应一个异常处理器</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-18_21-12-42.png?raw=true" alt="异常处理器"></p> <p>1，自定义错误页(直接在error/目录下创建状态码对应的html)</p> <p>error/404.html   error/5xx.html；有精确的错误状态码页面就匹配精确，没有就找 4xx.html；如果都没有就触发白页</p> <p>2，@ControllerAdvice+@ExceptionHandler处理全局异常；底层是 <strong>ExceptionHandlerExceptionResolver</strong> 支持的</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//推荐使用，理论上可以处理所有异常</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExeptionController</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">TooMangException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">MissingServletRequestParameterException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//参数绑定异常</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">soleve</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;异常信息{}&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;table/basic_table&quot;</span><span class="token punctuation">;</span><span class="token comment">//页面</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3，@ResponseStatus+自定义异常 ；底层是 <strong>ResponseStatusExceptionResolver</strong> ，把responsestatus注解的信息进行封装，底层调用 response.sendError(statusCode, resolvedReason)（<strong>tomcat发送/error请求</strong>）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//这个只是增加了框架中的异常种类而已</span>
<span class="token comment">//这个一般是java底层的异常种类不够用时才使用，抛出的异常也可以被上面第二点接收处理</span>
<span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>FORBIDDEN<span class="token punctuation">,</span> reason <span class="token operator">=</span> <span class="token string">&quot;数量太多了&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TooMangException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">TooMangException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">TooMangException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//在需要的地方throw new TooMangException();即可</span>
</code></pre></div><p>4，Spring底层的异常，如 参数类型转换异常(具体可看类中doResolveException方法)；底层是<strong>DefaultHandlerExceptionResolver</strong> --》 doResolveException。</p> <p>最终调用response.sendError(HttpServletResponse.<strong>SC_BAD_REQUEST</strong>, ex.getMessage());</p> <p>5，自定义实现HandlerExceptionResolver处理异常，可以作为<strong>默认的全局异常处理规则</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//这种可以当初统一的异常处理，如果优先级数组设置为最小，那么所有异常解析器都会使用这个</span>
<span class="token comment">//可以设置优先级低一点(默认好像就是最后一个遍历到的异常解析器)，然后搭配第二点的方法对一些异常进行特殊处理。</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Ordered</span><span class="token punctuation">.</span>HIGHEST_PRECEDENCE<span class="token punctuation">)</span>  <span class="token comment">//数值越低，优先级越高，这里设置最小</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHanderExceptionReslove</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerExceptionResolver</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>设置后异常解析器就多了一个，而且因为设置了@Order最小值，所以会是第一个遍历的，如果返回了mv，其他的异常处理器也就没有机会处理了。</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-19_14-33-40.png?raw=true" alt="自定义异常解析器"></p> <p>6，<strong>ErrorViewResolver</strong>  实现自定义处理异常；</p> <ul><li><p>response.sendError 。error请求就会转给controller</p></li> <li><p>你的异常没有任何人能处理。tomcat底层 response.sendError。error请求就会转给controller</p></li> <li><p>basicErrorController 要去的页面地址是 ErrorViewResolver  ；</p></li></ul> <h4 id="_8-3、异常处理自动配置原理"><a href="#_8-3、异常处理自动配置原理" class="header-anchor">#</a> 8.3、异常处理自动配置原理</h4> <p><strong>具体三个组件(错误页面信息，返回的信息格式，返回页面的路径)</strong></p> <p><strong>ErrorMvcAutoConfiguration  自动配置异常处理规则</strong></p> <p>​	<strong>容器中的组件1：类型：DefaultErrorAttributes -&gt;</strong> <strong>id：errorAttributes</strong></p> <ul><li>​		<strong>public class DefaultErrorAttributes implements ErrorAttributes, HandlerExceptionResolver, Ordered{}</strong></li> <li>​		<strong>DefaultErrorAttributes</strong>：定义错误页面中可以包含哪些数据。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getErrorAttributes</span><span class="token punctuation">(</span><span class="token class-name">WebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token class-name">ErrorAttributeOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> errorAttributes <span class="token operator">=</span> <span class="token function">getErrorAttributes</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token function">isIncluded</span><span class="token punctuation">(</span><span class="token class-name">Include</span><span class="token punctuation">.</span>STACK_TRACE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span><span class="token function">isIncluded</span><span class="token punctuation">(</span><span class="token class-name">Include</span><span class="token punctuation">.</span>EXCEPTION<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			errorAttributes<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span><span class="token function">isIncluded</span><span class="token punctuation">(</span><span class="token class-name">Include</span><span class="token punctuation">.</span>STACK_TRACE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			errorAttributes<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;trace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span><span class="token function">isIncluded</span><span class="token punctuation">(</span><span class="token class-name">Include</span><span class="token punctuation">.</span>MESSAGE<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> errorAttributes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			errorAttributes<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span><span class="token function">isIncluded</span><span class="token punctuation">(</span><span class="token class-name">Include</span><span class="token punctuation">.</span>BINDING_ERRORS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			errorAttributes<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;errors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> errorAttributes<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getErrorAttributes</span><span class="token punctuation">(</span><span class="token class-name">WebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token keyword">boolean</span> includeStackTrace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> errorAttributes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		errorAttributes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">addStatus</span><span class="token punctuation">(</span>errorAttributes<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">addErrorDetails</span><span class="token punctuation">(</span>errorAttributes<span class="token punctuation">,</span> webRequest<span class="token punctuation">,</span> includeStackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">addPath</span><span class="token punctuation">(</span>errorAttributes<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> errorAttributes<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>​	<strong>容器中的组件2：类型：BasicErrorController --&gt; id：basicErrorController（json+白页 适配响应）</strong></p> <p>​	处理默认 <strong>/error</strong> 路径的请求；errorHtml()页面响应 new ModelAndView(&quot;error&quot;, model)；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//BasicErrorController 两个请求，一个返回错误页面，一个返回json数据</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>produces <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_HTML_VALUE<span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">errorHtml</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>省略<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token keyword">return</span> <span class="token punctuation">(</span>modelAndView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> modelAndView <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@RequestMapping</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>省略<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><p>​	容器中有组件  <strong>defaultErrorView(View)</strong> -&gt; id是error；（响应默认错误页）</p> <p>​	容器中放组件 <strong>BeanNameViewResolver</strong>（视图解析器）；按照返回的视图名作为组件的id去容器中找View对象。</p> <p>**容器中的组件3：**类型：**DefaultErrorViewResolver -&gt; id：**conventionErrorViewResolver</p> <p>如果发生错误，会以HTTP的状态码 作为视图页地址（viewName），找到真正的页面</p> <ul><li>error/404、5xx.html</li></ul> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-18_15-23-43.png?raw=true" alt="视图路径"></p> <p>如果想要返回页面；就会找error视图【<strong>StaticView</strong>】。(默认是一个白页)</p> <h4 id="_8-4、异常处理步骤流程"><a href="#_8-4、异常处理步骤流程" class="header-anchor">#</a> 8.4、异常处理步骤流程</h4> <div class="language-java extra-class"><pre class="language-java"><code>mv <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开始分析</span>
</code></pre></div><p>1、执行目标方法，目标方法运行期间有任何异常都会被catch、而且标志当前请求结束；并且用 <strong>dispatchException</strong> 保存</p> <p>2、进入视图解析流程（页面渲染）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">processDispatchResult</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span> mv<span class="token punctuation">,</span> dispatchException<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3、<strong>mv</strong> = <strong>processHandlerException</strong>；处理handler发生的异常，处理完成返回ModelAndView；</p> <p>进入processHandlerException方法</p> <p>遍历所有的 <strong>handlerExceptionResolvers</strong>，看谁能处理当前异常【<strong>HandlerExceptionResolver</strong>处理器异常解析器】</p> <p>系统默认的 异常解析器如下</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-18_21-12-42.png?raw=true" alt="异常处理器"></p> <p><strong>DefaultErrorAttributes</strong>先来处理异常。把异常信息保存到request域，并且返回null；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span>
			<span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">storeErrorAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">storeErrorAttributes</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>ERROR_INTERNAL_ATTRIBUTE<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token comment">//其他异常解析器也依次遍历</span>
</code></pre></div><p>默认没有任何异常解析器能处理异常，所以异常会被抛出</p> <p>如果没有任何人能处理，最终<strong>底层就会发送 /error 请求</strong>。会被底层的<strong>BasicErrorController</strong>处理(参考8.3的组件2)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//进入</span>
<span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> status<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>解析错误视图；遍历所有的<strong>ErrorViewResolver</strong>  看谁能解析</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-18_21-56-50.png?raw=true" alt=""></p> <p>默认的 DefaultErrorViewResolver ,作用是把响应状态码作为错误页的地址，error/状态码.html</p> <p>模板引擎最终响应这个页面 <strong>error/状态码.html</strong></p> <h3 id="_9、web原生组件注入-servlet、filter、listener"><a href="#_9、web原生组件注入-servlet、filter、listener" class="header-anchor">#</a> 9、Web原生组件注入（Servlet、Filter、Listener）</h3> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.embedded-container.context-initializer.scanning" target="_blank" rel="noopener noreferrer">官网介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_9-1、使用servlet-api"><a href="#_9-1、使用servlet-api" class="header-anchor">#</a> 9.1、使用Servlet API</h4> <p>@ServletComponentScan(basePackages = <strong>&quot;com.example.boot&quot;</strong>) :指定原生Servlet组件都放在那里</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ServletComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.example.boot&quot;</span><span class="token punctuation">)</span><span class="token comment">//下面3个必须在这个包下才生效</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BootdemoApplication</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>@WebServlet(urlPatterns = <strong>&quot;/my&quot;</strong>)：效果：直接响应，<strong>没有经过Spring的拦截器？</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns<span class="token operator">=</span><span class="token string">&quot;/my&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> mySevlet <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
</code></pre></div><p>@WebFilter(urlPatterns={<strong>&quot;/css/*&quot;</strong>,<strong>&quot;/images/*&quot;</strong>})</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;/css/*&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/images/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>@WebListener</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@WebListener</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>推荐可以这种方式；</p> <h4 id="_9-2、使用registrationbean"><a href="#_9-2、使用registrationbean" class="header-anchor">#</a> 9.2、使用RegistrationBean</h4> <p>ServletRegistrationBean<code>,</code>FilterRegistrationBean<code>, and</code>ServletListenerRegistrationBean</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRegistConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">myServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MyServlet</span> myServlet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//上面去掉@WebServlet的类</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span>myServlet<span class="token punctuation">,</span><span class="token string">&quot;/my&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/my02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">myFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MyFilter</span> myFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//return new FilterRegistrationBean(myFilter,myServlet());只过滤myServlet()的路径</span>
        <span class="token class-name">FilterRegistrationBean</span> filterRegistrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span>myFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterRegistrationBean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;/my&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/css/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> filterRegistrationBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletListenerRegistrationBean</span> <span class="token function">myListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MyListener</span> myListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServletListenerRegistrationBean</span><span class="token punctuation">(</span>myListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_9-3-dispatchservlet-如何注册进来"><a href="#_9-3-dispatchservlet-如何注册进来" class="header-anchor">#</a> 9.3，DispatchServlet 如何注册进来</h4> <ul><li>容器中自动配置了  DispatcherServlet  属性绑定到 WebMvcProperties；对应的配置文件配置项是 <strong>spring.mvc。</strong></li> <li><strong>通过</strong> <strong>ServletRegistrationBean</strong><DispatcherServlet> 把 DispatcherServlet  配置进来。</DispatcherServlet></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DispatcherServletRegistrationBean</span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DispatcherServletRegistrationBean</span><span class="token punctuation">(</span>dispatcherServlet<span class="token punctuation">,</span>webMvcProperties<span class="token punctuation">.</span><span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>默认映射的是 / 路径。</li></ul> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-19_16-17-29.png?raw=true" alt="处理结构"></p> <p>Tomcat-Servlet；</p> <p>多个Servlet都能处理到同一层路径，采用精确优选原则</p> <h3 id="_10、嵌入式servlet容器"><a href="#_10、嵌入式servlet容器" class="header-anchor">#</a> 10、嵌入式Servlet容器</h3> <h4 id="_10-1、切换servlet服务器"><a href="#_10-1、切换servlet服务器" class="header-anchor">#</a> 10.1、切换Servlet服务器</h4> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.embedded-container.context-initializer.scanning" target="_blank" rel="noopener noreferrer">官网介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>默认支持的webServer</strong></p> <ul><li><p><code>Tomcat</code>, <code>Jetty</code>, or <code>Undertow</code></p></li> <li><p><code>ServletWebServerApplicationContext</code> 容器启动寻找<code>ServletWebServerFactory</code> 并引导创建服务器`</p></li></ul> <p>​        切换服务器</p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-19_20-39-42.png?raw=true" alt="服务器总类"></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 默认导入tomcat，如果需要换服务器，需要先移除，再引入其他服务器依赖 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 比如导入undertow服务器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-undertow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>服务器启动原理</strong></p> <p>大致路线：容器------&gt;工厂-------&gt;服务器</p> <ul><li>1，SpringBoot应用启动发现当前是Web应用。web场景包-导入tomcat</li> <li>web应用会创建一个web版的ioc容器 <code>ServletWebServerApplicationContext</code></li> <li>2，ServletWebServerApplicationContext<code>启动的时候寻找</code>ServletWebServerFactory``（Servlet 的web服务器工厂---&gt; Servlet 的web服务器）`</li> <li>3，SpringBoot底层默认有很多的WebServer工厂；<code>TomcatServletWebServerFactory</code>, <code>JettyServletWebServerFactory</code>, or <code>UndertowServletWebServerFactory</code></li> <li>4，底层直接会有一个自动配置类。<code>ServletWebServerFactoryAutoConfiguration</code></li> <li>5，<code>ServletWebServerFactoryAutoConfiguration</code>导入了<code>ServletWebServerFactoryConfiguration</code>（配置类，含有上面3个WebServer工厂）</li> <li>6，<code>ServletWebServerFactoryConfiguration</code> 配置类 根据动态判断系统中到底导入了那个Web服务器的包。（默认是web-starter导入tomcat包），容器中就有 <code>TomcatServletWebServerFactory</code></li> <li>7，<code>TomcatServletWebServerFactory</code> 创建出Tomcat服务器并启动；<code>TomcatWebServer</code> 的构造器拥有初始化方法<code>nitialize---this.tomcat.start()</code>;</li> <li>8，内嵌服务器，就是手动把启动服务器的代码调用（tomcat核心jar包存在）</li></ul> <h4 id="_10-2、定制servlet容器"><a href="#_10-2、定制servlet容器" class="header-anchor">#</a> 10.2、定制Servlet容器</h4> <p><strong>3种方式</strong></p> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-web-applications.embedded-container.servlets-filters-listeners.beans" target="_blank" rel="noopener noreferrer">官网了解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>1，实现  <strong>WebServerFactoryCustomizer</strong><ConfigurableServletWebServerFactory></ConfigurableServletWebServerFactory></p> <ul><li>把配置文件的值和<code>ServletWebServerFactory*</code> 进行绑定</li></ul> <p>2，修改配置文件 <strong>server.xxx</strong>(推荐使用，简单方便)</p> <p>3，直接自定义 <strong>ConfigurableServletWebServerFactory</strong></p> <p><img src="https://github.com/jack110959/pictures/blob/main/imgSnipaste_2021-10-19_21-25-24.png?raw=true" alt=""></p> <p><strong>xxxxxCustomizer</strong>：定制化器，可以改变xxxx的默认规则</p> <h3 id="_11、定制化原理"><a href="#_11、定制化原理" class="header-anchor">#</a> 11、定制化原理</h3> <h4 id="_11-1、定制化的常见方式"><a href="#_11-1、定制化的常见方式" class="header-anchor">#</a> 11.1、定制化的常见方式</h4> <ul><li>修改配置文件；</li> <li><strong>xxxxxCustomizer；</strong></li> <li><strong>编写自定义的配置类   xxxConfiguration；+</strong> <strong>@Bean替换、增加容器中默认组件；视图解析器</strong></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">webMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//类里面重写对应的添加组件方法}</span>
</code></pre></div><ul><li><strong>Web应用 编写一个配置类实现</strong> <strong>WebMvcConfigurer 即可定制化web功能；+ @Bean给容器中再扩展一些组件</strong></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminWebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">{</span><span class="token comment">//类里面重写对应的注册方法即可}</span>
<span class="token comment">//拦截器，转换器等都可以采用这种方式，可以参考WebMvcConfigurer提供的方法</span>
</code></pre></div><ul><li><p>@EnableWebMvc + WebMvcConfigurer —— @Bean  可以全面接管SpringMVC，所有规则全部自己重新配置； 实现定制和扩展功能</p> <p><strong>原理</strong></p> <p>​	1、WebMvcAutoConfiguration  默认的SpringMVC的自动配置功能类。静态资源、欢迎页.....</p> <p>​	2、一旦使用 @EnableWebMvc ，会 @Import(<strong>DelegatingWebMvcConfiguration</strong>.class)</p> <p>​	3、<strong>DelegatingWebMvcConfiguration</strong>  只保证SpringMVC最基本的使用，<strong>作用如下：</strong></p> <p>​			把所有系统中的 WebMvcConfigurer 拿过来。所有功能的定制都是这些 WebMvcConfigurer  合起来一起生效</p> <p>​			自动配置了一些非常底层的组件。<strong>RequestMappingHandlerMapping</strong>、这些组件依赖的组件都是从容器中获取</p> <p>​			public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport</p> <p>​	4、<strong>WebMvcAutoConfiguration</strong> 里面的配置生效的条件@ConditionalOnMissingBean(<strong>WebMvcConfigurationSupport</strong>.<strong>class</strong>)</p> <p>​	5、@EnableWebMvc  导致了 <strong>WebMvcAutoConfiguration  没有生效。</strong></p></li></ul> <h4 id="_11-2、原理分析套路"><a href="#_11-2、原理分析套路" class="header-anchor">#</a> 11.2、原理分析套路</h4> <p><strong>场景starter</strong> <strong>- xxxxAutoConfiguration - 导入xxx组件 - 绑定xxxProperties --</strong> <strong>绑定配置文件项</strong></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/vuejs/vuepress/edit/master/docs/SpringBoot2/SpringBootSecond.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/dose1/assets/js/app.370f2ecb.js" defer></script><script src="/dose1/assets/js/2.579f079f.js" defer></script><script src="/dose1/assets/js/9.fb95937f.js" defer></script>
  </body>
</html>
